(function(){"use strict";function yn(n,e,t,r,i){vt(n,e,t||0,r||n.length-1,i||gn)}function vt(n,e,t,r,i){for(;r>t;){if(r-t>600){var s=r-t+1,a=e-t+1,o=Math.log(s),u=.5*Math.exp(2*o/3),c=.5*Math.sqrt(o*u*(s-u)/s)*(a-s/2<0?-1:1),l=Math.max(t,Math.floor(e-a*u/s+c)),f=Math.min(r,Math.floor(e+(s-a)*u/s+c));vt(n,e,l,f,i)}var d=n[e],p=t,m=r;for(he(n,t,e),i(n[r],d)>0&&he(n,t,r);p<m;){for(he(n,p,m),p++,m--;i(n[p],d)<0;)p++;for(;i(n[m],d)>0;)m--}i(n[t],d)===0?he(n,t,m):(m++,he(n,m,r)),m<=e&&(t=m+1),e<=m&&(r=m-1)}}function he(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}function gn(n,e){return n<e?-1:n>e?1:0}class vn{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const r=[];if(!Ne(e,t))return r;const i=this.toBBox,s=[];for(;t;){for(let a=0;a<t.children.length;a++){const o=t.children[a],u=t.leaf?i(o):o;Ne(e,u)&&(t.leaf?r.push(o):tt(e,u)?this._all(o,r):s.push(o))}t=s.pop()}return r}collides(e){let t=this.data;if(!Ne(e,t))return!1;const r=[];for(;t;){for(let i=0;i<t.children.length;i++){const s=t.children[i],a=t.leaf?this.toBBox(s):s;if(Ne(e,a)){if(t.leaf||tt(e,a))return!0;r.push(s)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const r=this.data;this.data=t,t=r}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=te([]),this}remove(e,t){if(!e)return this;let r=this.data;const i=this.toBBox(e),s=[],a=[];let o,u,c;for(;r||s.length;){if(r||(r=s.pop(),u=s[s.length-1],o=a.pop(),c=!0),r.leaf){const l=xn(e,r.children,t);if(l!==-1)return r.children.splice(l,1),s.push(r),this._condense(s),this}!c&&!r.leaf&&tt(r,i)?(s.push(r),a.push(o),o=0,u=r,r=r.children[0]):u?(o++,r=u.children[o],c=!1):r=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,i){const s=r-t+1;let a=this._maxEntries,o;if(s<=a)return o=te(e.slice(t,r+1)),ee(o,this.toBBox),o;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),o=te([]),o.leaf=!1,o.height=i;const u=Math.ceil(s/a),c=u*Math.ceil(Math.sqrt(a));xt(e,t,r,c,this.compareMinX);for(let l=t;l<=r;l+=c){const f=Math.min(l+c-1,r);xt(e,l,f,u,this.compareMinY);for(let d=l;d<=f;d+=u){const p=Math.min(d+u-1,f);o.children.push(this._build(e,d,p,i-1))}}return ee(o,this.toBBox),o}_chooseSubtree(e,t,r,i){for(;i.push(t),!(t.leaf||i.length-1===r);){let s=1/0,a=1/0,o;for(let u=0;u<t.children.length;u++){const c=t.children[u],l=et(c),f=Mn(e,c)-l;f<a?(a=f,s=l<s?l:s,o=c):f===a&&l<s&&(s=l,o=c)}t=o||t.children[0]}return t}_insert(e,t,r){const i=r?e:this.toBBox(e),s=[],a=this._chooseSubtree(i,this.data,t,s);for(a.children.push(e),pe(a,i);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(i,s,t)}_split(e,t){const r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);const a=this._chooseSplitIndex(r,s,i),o=te(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,ee(r,this.toBBox),ee(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(r,o)}_splitRoot(e,t){this.data=te([e,t]),this.data.height=e.height+1,this.data.leaf=!1,ee(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let i,s=1/0,a=1/0;for(let o=t;o<=r-t;o++){const u=fe(e,0,o,this.toBBox),c=fe(e,o,r,this.toBBox),l=Tn(u,c),f=et(u)+et(c);l<s?(s=l,i=o,a=f<a?f:a):l===s&&f<a&&(a=f,i=o)}return i||r-t}_chooseSplitAxis(e,t,r){const i=e.leaf?this.compareMinX:_n,s=e.leaf?this.compareMinY:wn,a=this._allDistMargin(e,t,r,i),o=this._allDistMargin(e,t,r,s);a<o&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const s=this.toBBox,a=fe(e,0,t,s),o=fe(e,r-t,r,s);let u=Pe(a)+Pe(o);for(let c=t;c<r-t;c++){const l=e.children[c];pe(a,e.leaf?s(l):l),u+=Pe(a)}for(let c=r-t-1;c>=t;c--){const l=e.children[c];pe(o,e.leaf?s(l):l),u+=Pe(o)}return u}_adjustParentBBoxes(e,t,r){for(let i=r;i>=0;i--)pe(t[i],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)e[t].children.length===0?t>0?(r=e[t-1].children,r.splice(r.indexOf(e[t]),1)):this.clear():ee(e[t],this.toBBox)}}function xn(n,e,t){if(!t)return e.indexOf(n);for(let r=0;r<e.length;r++)if(t(n,e[r]))return r;return-1}function ee(n,e){fe(n,0,n.children.length,e,n)}function fe(n,e,t,r,i){i||(i=te(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=e;s<t;s++){const a=n.children[s];pe(i,n.leaf?r(a):a)}return i}function pe(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function _n(n,e){return n.minX-e.minX}function wn(n,e){return n.minY-e.minY}function et(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Pe(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Mn(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function Tn(n,e){const t=Math.max(n.minX,e.minX),r=Math.max(n.minY,e.minY),i=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,i-t)*Math.max(0,s-r)}function tt(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Ne(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function te(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function xt(n,e,t,r,i){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=r)continue;const a=e+Math.ceil((t-e)/r/2)*r;yn(n,a,e,t,i),s.push(e,a,a,t)}}var nt={exports:{}};nt.exports=ke,nt.exports.default=ke;function ke(n,e,t){t=t||2;var r=e&&e.length,i=r?e[0]*t:n.length,s=_t(n,0,i,t,!0),a=[];if(!s||s.next===s.prev)return a;var o,u,c,l,f,d,p;if(r&&(s=An(n,e,s,t)),n.length>80*t){o=c=n[0],u=l=n[1];for(var m=t;m<i;m+=t)f=n[m],d=n[m+1],f<o&&(o=f),d<u&&(u=d),f>c&&(c=f),d>l&&(l=d);p=Math.max(c-o,l-u),p=p!==0?1/p:0}return me(s,a,t,o,u,p),a}function _t(n,e,t,r,i){var s,a;if(i===st(n,e,t,r)>0)for(s=e;s<t;s+=r)a=Tt(s,n[s],n[s+1],a);else for(s=t-r;s>=e;s-=r)a=Tt(s,n[s],n[s+1],a);return a&&Re(a,a.next)&&(ge(a),a=a.next),a}function B(n,e){if(!n)return n;e||(e=n);var t=n,r;do if(r=!1,!t.steiner&&(Re(t,t.next)||I(t.prev,t,t.next)===0)){if(ge(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function me(n,e,t,r,i,s,a){if(!!n){!a&&s&&Zn(n,r,i,s);for(var o=n,u,c;n.prev!==n.next;){if(u=n.prev,c=n.next,s?bn(n,r,i,s):En(n)){e.push(u.i/t),e.push(n.i/t),e.push(c.i/t),ge(n),n=c.next,o=c.next;continue}if(n=c,n===o){a?a===1?(n=Sn(B(n),e,t),me(n,e,t,r,i,s,2)):a===2&&In(n,e,t,r,i,s):me(B(n),e,t,r,i,s,1);break}}}}function En(n){var e=n.prev,t=n,r=n.next;if(I(e,t,r)>=0)return!1;for(var i=n.next.next;i!==n.prev;){if(ne(e.x,e.y,t.x,t.y,r.x,r.y,i.x,i.y)&&I(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function bn(n,e,t,r){var i=n.prev,s=n,a=n.next;if(I(i,s,a)>=0)return!1;for(var o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,u=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,c=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,l=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,f=rt(o,u,e,t,r),d=rt(c,l,e,t,r),p=n.prevZ,m=n.nextZ;p&&p.z>=f&&m&&m.z<=d;){if(p!==n.prev&&p!==n.next&&ne(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&I(p.prev,p,p.next)>=0||(p=p.prevZ,m!==n.prev&&m!==n.next&&ne(i.x,i.y,s.x,s.y,a.x,a.y,m.x,m.y)&&I(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=f;){if(p!==n.prev&&p!==n.next&&ne(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&I(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==n.prev&&m!==n.next&&ne(i.x,i.y,s.x,s.y,a.x,a.y,m.x,m.y)&&I(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Sn(n,e,t){var r=n;do{var i=r.prev,s=r.next.next;!Re(i,s)&&wt(i,r,r.next,s)&&ye(i,s)&&ye(s,i)&&(e.push(i.i/t),e.push(r.i/t),e.push(s.i/t),ge(r),ge(r.next),r=n=s),r=r.next}while(r!==n);return B(r)}function In(n,e,t,r,i,s){var a=n;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&jn(a,o)){var u=Mt(a,o);a=B(a,a.next),u=B(u,u.next),me(a,e,t,r,i,s),me(u,e,t,r,i,s);return}o=o.next}a=a.next}while(a!==n)}function An(n,e,t,r){var i=[],s,a,o,u,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,u=s<a-1?e[s+1]*r:n.length,c=_t(n,o,u,r,!1),c===c.next&&(c.steiner=!0),i.push(Cn(c));for(i.sort(Pn),s=0;s<i.length;s++)t=Nn(i[s],t),t=B(t,t.next);return t}function Pn(n,e){return n.x-e.x}function Nn(n,e){var t=kn(n,e);if(!t)return e;var r=Mt(t,n),i=B(t,t.next);return B(r,r.next),e===t?i:e}function kn(n,e){var t=e,r=n.x,i=n.y,s=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var o=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=r&&o>s){if(s=o,o===r){if(i===t.y)return t;if(i===t.next.y)return t.next}a=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!a)return null;if(r===s)return a;var u=a,c=a.x,l=a.y,f=1/0,d;t=a;do r>=t.x&&t.x>=c&&r!==t.x&&ne(i<l?r:s,i,c,l,i<l?s:r,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(r-t.x),ye(t,n)&&(d<f||d===f&&(t.x>a.x||t.x===a.x&&Rn(a,t)))&&(a=t,f=d)),t=t.next;while(t!==u);return a}function Rn(n,e){return I(n.prev,n,e.prev)<0&&I(e.next,n,n.next)<0}function Zn(n,e,t,r){var i=n;do i.z===null&&(i.z=rt(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,On(i)}function On(n){var e,t,r,i,s,a,o,u,c=1;do{for(t=n,n=null,s=null,a=0;t;){for(a++,r=t,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(u=c;o>0||u>0&&r;)o!==0&&(u===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,o--):(i=r,r=r.nextZ,u--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,c*=2}while(a>1);return n}function rt(n,e,t,r,i){return n=32767*(n-t)*i,e=32767*(e-r)*i,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Cn(n){var e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function ne(n,e,t,r,i,s,a,o){return(i-a)*(e-o)-(n-a)*(s-o)>=0&&(n-a)*(r-o)-(t-a)*(e-o)>=0&&(t-a)*(s-o)-(i-a)*(r-o)>=0}function jn(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!Dn(n,e)&&(ye(n,e)&&ye(e,n)&&Xn(n,e)&&(I(n.prev,n,e.prev)||I(n,e.prev,e))||Re(n,e)&&I(n.prev,n,n.next)>0&&I(e.prev,e,e.next)>0)}function I(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Re(n,e){return n.x===e.x&&n.y===e.y}function wt(n,e,t,r){var i=Oe(I(n,e,t)),s=Oe(I(n,e,r)),a=Oe(I(t,r,n)),o=Oe(I(t,r,e));return!!(i!==s&&a!==o||i===0&&Ze(n,t,e)||s===0&&Ze(n,r,e)||a===0&&Ze(t,n,r)||o===0&&Ze(t,e,r))}function Ze(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Oe(n){return n>0?1:n<0?-1:0}function Dn(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&wt(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function ye(n,e){return I(n.prev,n,n.next)<0?I(n,e,n.next)>=0&&I(n,n.prev,e)>=0:I(n,e,n.prev)<0||I(n,n.next,e)<0}function Xn(n,e){var t=n,r=!1,i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function Mt(n,e){var t=new it(n.i,n.x,n.y),r=new it(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function Tt(n,e,t,r){var i=new it(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ge(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function it(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ke.deviation=function(n,e,t,r){var i=e&&e.length,s=i?e[0]*t:n.length,a=Math.abs(st(n,0,s,t));if(i)for(var o=0,u=e.length;o<u;o++){var c=e[o]*t,l=o<u-1?e[o+1]*t:n.length;a-=Math.abs(st(n,c,l,t))}var f=0;for(o=0;o<r.length;o+=3){var d=r[o]*t,p=r[o+1]*t,m=r[o+2]*t;f+=Math.abs((n[d]-n[m])*(n[p+1]-n[d+1])-(n[d]-n[p])*(n[m+1]-n[d+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function st(n,e,t,r){for(var i=0,s=e,a=t-r;s<t;s+=r)i+=(n[a]-n[s])*(n[s+1]+n[a+1]),a=s;return i}ke.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,i=0;i<n.length;i++){for(var s=0;s<n[i].length;s++)for(var a=0;a<e;a++)t.vertices.push(n[i][s][a]);i>0&&(r+=n[i-1].length,t.holes.push(r))}return t};var Et=nt.exports,re={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},ie={};ie[re.RADIANS]=6370997/(2*Math.PI),ie[re.DEGREES]=2*Math.PI*6370997/360,ie[re.FEET]=.3048,ie[re.METERS]=1,ie[re.USFEET]=1200/3937;var bt=re,Yn=function(){function n(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}return n.prototype.canWrapX=function(){return this.canWrapX_},n.prototype.getCode=function(){return this.code_},n.prototype.getExtent=function(){return this.extent_},n.prototype.getUnits=function(){return this.units_},n.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ie[this.units_]},n.prototype.getWorldExtent=function(){return this.worldExtent_},n.prototype.getAxisOrientation=function(){return this.axisOrientation_},n.prototype.isGlobal=function(){return this.global_},n.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)},n.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},n.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},n.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)},n.prototype.setWorldExtent=function(e){this.worldExtent_=e},n.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},n.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},n}(),St=Yn,Gn=function(){var n;return"cosh"in Math?n=Math.cosh:n=function(e){var t=Math.exp(e);return(t+1/t)/2},n}(),Vn=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),ve=6378137,se=Math.PI*ve,Bn=[-se,-se,se,se],Fn=[-180,-85,180,85],Ce=ve*Math.log(Math.tan(Math.PI/2)),ae=function(n){Vn(e,n);function e(t){return n.call(this,{code:t,units:bt.METERS,extent:Bn,global:!0,worldExtent:Fn,getPointResolution:function(r,i){return r/Gn(i[1]/ve)}})||this}return e}(St),It=[new ae("EPSG:3857"),new ae("EPSG:102100"),new ae("EPSG:102113"),new ae("EPSG:900913"),new ae("http://www.opengis.net/def/crs/EPSG/0/3857"),new ae("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Un(n,e,t){var r=n.length,i=t>1?t:2,s=e;s===void 0&&(i>2?s=n.slice():s=new Array(r));for(var a=0;a<r;a+=i){s[a]=se*n[a]/180;var o=ve*Math.log(Math.tan(Math.PI*(+n[a+1]+90)/360));o>Ce?o=Ce:o<-Ce&&(o=-Ce),s[a+1]=o}return s}function Ln(n,e,t){var r=n.length,i=t>1?t:2,s=e;s===void 0&&(i>2?s=n.slice():s=new Array(r));for(var a=0;a<r;a+=i)s[a]=180*n[a]/se,s[a+1]=360*Math.atan(Math.exp(n[a+1]/ve))/Math.PI-90;return s}var $n=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Wn=6378137,At=[-180,-90,180,90],zn=Math.PI*Wn/180,W=function(n){$n(e,n);function e(t,r){return n.call(this,{code:t,units:bt.DEGREES,extent:At,axisOrientation:r,global:!0,metersPerUnit:zn,worldExtent:At})||this}return e}(St),Pt=[new W("CRS:84"),new W("EPSG:4326","neu"),new W("urn:ogc:def:crs:OGC:1.3:CRS84"),new W("urn:ogc:def:crs:OGC:2:84"),new W("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new W("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new W("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],at={};function Hn(n){return at[n]||at[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function qn(n,e){at[n]=e}var oe={};function je(n,e,t){var r=n.getCode(),i=e.getCode();r in oe||(oe[r]={}),oe[r][i]=t}function Jn(n,e){var t;return n in oe&&e in oe[n]&&(t=oe[n][e]),t}function Nt(n,e,t){var r;if(e!==void 0){for(var i=0,s=n.length;i<s;++i)e[i]=n[i];r=e}else r=n.slice();return r}function Kn(n,e,t){if(e!==void 0&&n!==e){for(var r=0,i=n.length;r<i;++r)e[r]=n[r];n=e}return n}function Qn(n){qn(n.getCode(),n),je(n,n,Nt)}function er(n){n.forEach(Qn)}function kt(n){return typeof n=="string"?Hn(n):n||null}function Rt(n){er(n),n.forEach(function(e){n.forEach(function(t){e!==t&&je(e,t,Nt)})})}function tr(n,e,t,r){n.forEach(function(i){e.forEach(function(s){je(i,s,t),je(s,i,r)})})}function nr(n,e){return sr(n,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function rr(n,e){var t=n.getCode(),r=e.getCode(),i=Jn(t,r);return i||(i=Kn),i}function ir(n,e){var t=kt(n),r=kt(e);return rr(t,r)}function sr(n,e,t){var r=ir(e,t);return r(n,void 0,n.length)}function ar(){Rt(It),Rt(Pt),tr(Pt,It,Un,Ln)}ar(),new Array(6);function Zt(n,e){var t=e[0],r=e[1];return e[0]=n[0]*t+n[2]*r+n[4],e[1]=n[1]*t+n[3]*r+n[5],e}const Ot=Number.POSITIVE_INFINITY,or=3,ce={MPARMERR:"PARAMETER ERROR",MINTERR:"INTERNAL ERROR",MUNSOLVABLE:"NOT SOLVABLE",MNPTERR:"NOT ENOUGH POINTS"};class cr{constructor(e,t,r,i){this.dfGCPPixel=e,this.dfGCPLine=t,this.dfGCPX=r,this.dfGCPY=i}}class ur{constructor(){this.count=0,this.e1=[],this.n1=[],this.e2=[],this.n2=[],this.status=[]}}class lr{constructor(){this.x1Mean=0,this.y1Mean=0,this.x2Mean=0,this.y2Mean=0,this.bReversed=!1,this.nOrder=1,this.bRefine=!1,this.dfTolerance=-1,this.nMinimumGcps=-1,this.nRefCount=1,this.pasGCPList=[],this.nGCPCount=0,this.adfToGeoX=[],this.adfToGeoY=[],this.adfFromGeoX=[],this.adfFromGeoY=[],this.adfToGeoX=[],this.adfToGeoY=[],this.adfFromGeoX=[],this.adfFromGeoY=[]}}class dr{constructor(e=0){this.n=e,this.v=[]}getM(e,t){return this.v[(e-1)*this.n+t-1]}setM(e,t,r){this.v[(e-1)*this.n+t-1]=r}}function hr(n,e,t){return fr(n,e,t,!1,-1,-1)}function fr(n,e,t,r,i,s){const a=n.length;let o=new ur,u=0,c=0,l=0,f=0;e=1;const d=new lr;if(d.bReversed=t,d.nOrder=e,d.bRefine=r,d.dfTolerance=i,d.nMinimumGcps=s,d.nRefCount=1,d.pasGCPList=n,d.nGCPCount=a,a===0)throw new Error("NOT ENOUGH POINTS");if(r)throw new Error("remove_outliers not implemented");{let p=[],m=[],A=[],R=[],V=[];for(let S=0;S<a;S++)V[S]=1,p[S]=n[S].dfGCPX,m[S]=n[S].dfGCPY,A[S]=n[S].dfGCPPixel,R[S]=n[S].dfGCPLine,u+=n[S].dfGCPPixel,c+=n[S].dfGCPLine,l+=n[S].dfGCPX,f+=n[S].dfGCPY;d.x1Mean=u/a,d.y1Mean=c/a,d.x2Mean=l/a,d.y2Mean=f/a,o.count=a,o.e1=A,o.n1=R,o.e2=p,o.n2=m,o.status=V,pr(d,o,d.adfToGeoX,d.adfToGeoY,d.adfFromGeoX,d.adfFromGeoY,e)}return d}function pr(n,e,t,r,i,s,a){let o;if(a<1||a>or)throw new Error(ce.MPARMERR);Ct(e,n.x1Mean,n.y1Mean,t,r,a),o=e.e1,e.e1=e.e2,e.e2=o,o=e.n1,e.n1=e.n2,e.n2=o,Ct(e,n.x2Mean,n.y2Mean,i,s,a),o=e.e1,e.e1=e.e2,e.e2=o,o=e.n1,e.n1=e.n2,e.n2=o}function Ct(n,e,t,r,i,s){const a=new dr;let o=[],u=[],c=0,l=0;for(l=c=0;l<n.count;l++)n.status[l]>0&&c++;if(a.n=(s+1)*(s+2)/2,c<a.n)throw new Error(ce.MNPTERR);a.v=[],c===a.n?yr(n,a,e,t,o,u,r,i):mr(n,a,e,t,o,u,r,i)}function mr(n,e,t,r,i,s,a,o){let u=0;for(let c=1;c<=e.n;c++){for(let l=c;l<=e.n;l++)e.setM(c,l,0);i[c-1]=s[c-1]=0}for(let c=0;c<n.count;c++)if(n.status[c]>0){u++;for(let l=1;l<=e.n;l++){for(let f=l;f<=e.n;f++)e.setM(l,f,e.getM(l,f)+xe(l,n.e1[c]-t,n.n1[c]-r)*xe(f,n.e1[c]-t,n.n1[c]-r));i[l-1]+=n.e2[c]*xe(l,n.e1[c]-t,n.n1[c]-r),s[l-1]+=n.n2[c]*xe(l,n.e1[c]-t,n.n1[c]-r)}}if(u<=e.n)throw new Error(ce.MINTERR);for(let c=2;c<=e.n;c++)for(let l=1;l<c;l++)e.setM(c,l,e.getM(l,c));return jt(e,i,s,a,o)}function yr(n,e,t,r,i,s,a,o){let u=1;for(let c=0;c<n.count;c++)if(n.status[c]>0){for(let l=1;l<=e.n;l++)e.setM(u,l,xe(l,n.e1[c]-t,n.n1[c]-r));i[u-1]=n.e2[c],s[u-1]=n.n2[c],u++}if(u-1!==e.n)throw new Error(ce.MINTERR);return jt(e,i,s,a,o)}function jt(n,e,t,r,i){for(let s=1;s<=n.n;s++){let a=s,o=n.getM(s,a),u=s;for(let c=s+1;c<=n.n;c++)Math.abs(n.getM(c,a))>Math.abs(o)&&(o=n.getM(c,a),u=c);if(o===0)throw new Error(ce.MUNSOLVABLE);if(u!==s){for(let p=1;p<=n.n;p++){const m=n.getM(u,p),A=n.getM(s,p);n.setM(u,p,A),n.setM(s,p,m)}const c=e[u-1],l=e[s-1];e[s-1]=c,e[u-1]=l;const f=t[u-1],d=t[s-1];t[u-1]=d,t[s-1]=f}for(let c=1;c<=n.n;c++)if(c!==s){const l=n.getM(c,a)/o;for(let f=a;f<=n.n;f++){const d=l*n.getM(s,f);n.setM(c,f,n.getM(c,f)-d)}e[c-1]-=l*e[s-1],t[c-1]-=l*t[s-1]}}for(let s=1;s<=n.n;s++)r[s-1]=e[s-1]/n.getM(s,s),i[s-1]=t[s-1]/n.getM(s,s)}function xe(n,e,t){switch(n){case 1:return 1;case 2:return e;case 3:return t;case 4:return e*e;case 5:return e*t;case 6:return t*t;case 7:return e*e*e;case 8:return e*e*t;case 9:return e*t*t;case 10:return t*t*t}return 0}function Dt(n,e,t){const r=t.length,i=n,s=[];i.bReversed&&(e=!e);for(let a=0;a<r;a++){if(t[a].x===Ot||t[a].y===Ot)throw new Error("HUGE_VAL");let o;e?o=Xt(t[a].x-i.x2Mean,t[a].y-i.y2Mean,i.adfFromGeoX,i.adfFromGeoY,i.nOrder):o=Xt(t[a].x-i.x1Mean,t[a].y-i.y1Mean,i.adfToGeoX,i.adfToGeoY,i.nOrder),s[a]={x:o[0],y:o[1]}}return s}function Xt(n,e,t,r,i){let s=0,a=0,o=0,u=0,c=0,l=0,f=0,d,p;if(i===1)return d=t[0]+t[1]*n+t[2]*e,p=r[0]+r[1]*n+r[2]*e,[d,p];if(i===2)return c=n*n,f=e*e,l=n*e,d=t[0]+t[1]*n+t[2]*e+t[3]*c+t[4]*l+t[5]*f,p=r[0]+r[1]*n+r[2]*e+r[3]*c+r[4]*l+r[5]*f,[d,p];if(i===3)return c=n*n,l=n*e,f=e*e,s=n*c,a=c*e,o=n*f,u=e*f,d=t[0]+t[1]*n+t[2]*e+t[3]*c+t[4]*l+t[5]*f+t[6]*s+t[7]*a+t[8]*o+t[9]*u,p=r[0]+r[1]*n+r[2]*e+r[3]*c+r[4]*l+r[5]*f+r[6]*s+r[7]*a+r[8]*o+r[9]*u,[d,p];throw new Error(ce.MPARMERR)}function Yt(n,e){const r=[{x:e[0],y:e[1]}],i=Dt(n,!1,r);return[i[0].y,i[0].x]}function De(n,e){const r=[{x:e[1],y:e[0]}],i=Dt(n,!0,r);return[i[0].x,i[0].y]}function gr(n){const e=n.map(r=>new cr(r.image[0],r.image[1],r.world[1],r.world[0]));return hr(e,0,!1)}var N=63710088e-1,Gt={centimeters:N*100,centimetres:N*100,degrees:N/111325,feet:N*3.28084,inches:N*39.37,kilometers:N/1e3,kilometres:N/1e3,meters:N,metres:N,miles:N/1609.344,millimeters:N*1e3,millimetres:N*1e3,nauticalmiles:N/1852,radians:1,yards:N*1.0936};function vr(n,e,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=e||{},r.geometry=n,r}function xr(n,e,t){if(t===void 0&&(t={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vt(n[0])||!Vt(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return vr(r,e,t)}function _r(n,e){e===void 0&&(e="kilometers");var t=Gt[e];if(!t)throw new Error(e+" units is invalid");return n*t}function wr(n,e){e===void 0&&(e="kilometers");var t=Gt[e];if(!t)throw new Error(e+" units is invalid");return n/t}function ot(n){var e=n%(2*Math.PI);return e*180/Math.PI}function Z(n){var e=n%360;return e*Math.PI/180}function Vt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function _e(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Bt(n,e,t){if(t===void 0&&(t={}),t.final===!0)return Mr(n,e);var r=_e(n),i=_e(e),s=Z(r[0]),a=Z(i[0]),o=Z(r[1]),u=Z(i[1]),c=Math.sin(a-s)*Math.cos(u),l=Math.cos(o)*Math.sin(u)-Math.sin(o)*Math.cos(u)*Math.cos(a-s);return ot(Math.atan2(c,l))}function Mr(n,e){var t=Bt(e,n);return t=(t+180)%360,t}function Tr(n,e,t,r){r===void 0&&(r={});var i=_e(n),s=Z(i[0]),a=Z(i[1]),o=Z(t),u=wr(e,r.units),c=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(o)),l=s+Math.atan2(Math.sin(o)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(c)),f=ot(l),d=ot(c);return xr([f,d],r.properties)}function ct(n,e,t){t===void 0&&(t={});var r=_e(n),i=_e(e),s=Z(i[1]-r[1]),a=Z(i[0]-r[0]),o=Z(r[1]),u=Z(i[1]),c=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(o)*Math.cos(u);return _r(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),t.units)}function Er(n,e){var t=ct(n,e),r=Bt(n,e),i=Tr(n,t/2,r);return i}function we(n){return{type:"Point",coordinates:n}}function br(n,e,t=.01,r=8){const i=e.map(o=>({image:o,world:Yt(n,o)})),a=Array.from(Array(i.length-1)).map((o,u)=>({from:i[u],to:i[u+1]})).map(o=>ut(n,o,t,r)).flat(1);return{type:"Polygon",coordinates:[[a[0].from.world,...a.map(o=>o.to.world)]]}}function ut(n,e,t,r,i=0){const s=[(e.from.image[0]+e.to.image[0])/2,(e.from.image[1]+e.to.image[1])/2],a=Er(we(e.from.world),we(e.to.world)),o=we(Yt(n,s)),u=ct(we(e.from.world),we(e.to.world));if(ct(a,o)/u>t&&i<r){const l={image:s,world:o.coordinates};return[ut(n,{from:e.from,to:l},t,i+1),ut(n,{from:l,to:e.to},t,i+1)].flat(1)}else return e}function Ft(n){let e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;for(const r of n)e===void 0?r>=r&&(e=t=r):(e>r&&(e=r),t<r&&(t=r));return[e,t]}function Sr([n,e]){let t=Math.floor(n[0]),r=Math.floor(n[1]);const i=Math.floor(e[0]),s=Math.floor(e[1]);let a=[[t,r]];if(t===i&&r===s)return a;const o=Math.sign(e[0]-n[0]),u=Math.sign(e[1]-n[1]),c=Math.abs(n[0]-t-Math.max(0,o)),l=Math.abs(n[1]-r-Math.max(0,u)),f=Math.abs(n[0]-e[0]),d=Math.abs(n[1]-e[1]);let p=c/f,m=l/d;const A=1/f,R=1/d;for(;!(t===i&&r===s);)p<m?(p=p+A,t=t+o):(m=m+R,r=r+u),a.push([t,r]);return a}function Ir(n,e){const[t,r,i,s]=e;return[De(n,[t,r]),De(n,[t,s]),De(n,[i,s]),De(n,[i,r])]}function Ar(n){const e=[],t=[];for(let o of n)e.push(o[0]),t.push(o[1]);const[r,i]=Ft(e),[s,a]=Ft(t);return{minX:r,maxX:i,minY:s,maxY:a,width:i-r,height:a-s}}function Pr(n,e){let t=Number.POSITIVE_INFINITY,r;for(let i of n){const s=i.scaleFactor,a=Math.abs(Math.log2(s)-Math.log2(e));a<t&&(t=a,r=i)}return r}function Nr(n,e){return e.map(t=>[t[0]/n.originalWidth,t[1]/n.originalHeight])}function kr(n){const e={};for(let t=0;t<n.length;t++){const r=[n[t],n[(t+1)%n.length]];Sr(r).forEach(([s,a])=>{e[s]||(e[s]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),a<e[s][0]&&(e[s][0]=a),a>e[s][1]&&(e[s][1]=a)})}return e}function Rr(n,e){const t=[];for(let r in e){const i=parseInt(r);if(i<0||i>=n.columns)break;const s=Math.max(e[i][0],0),a=Math.min(e[i][1],n.rows-1);for(let o=s;o<=a;o++)t.push({column:i,row:o,zoomLevel:n})}return t}function Zr(n,e,t,r){const i=Ir(n,r),s=Ar(i);if((s.minX>e.width||s.maxX<0)&&(s.maxY>e.height||s.maxY<0))return[];const a=s.width/t[0],o=s.height/t[1],u=Math.min(a,o),c=Pr(e.tileZoomLevels,u);if(c){const l=Nr(c,i),f=kr(l);return Rr(c,f)}else return[]}var E;(function(n){function e(r){throw new Error}n.assertNever=e,n.arrayToEnum=r=>{const i={};for(const s of r)i[s]=s;return i},n.getValidEnumValues=r=>{const i=n.objectKeys(r).filter(a=>typeof r[r[a]]!="number"),s={};for(const a of i)s[a]=r[a];return n.objectValues(s)},n.objectValues=r=>n.objectKeys(r).map(function(i){return r[i]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&i.push(s);return i},n.find=(r,i)=>{for(const s of r)if(i(s))return s},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function t(r,i=" | "){return r.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}n.joinValues=t})(E||(E={}));const g=E.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),F=n=>{switch(typeof n){case"undefined":return g.undefined;case"string":return g.string;case"number":return isNaN(n)?g.nan:g.number;case"boolean":return g.boolean;case"function":return g.function;case"bigint":return g.bigint;case"object":return Array.isArray(n)?g.array:n===null?g.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?g.promise:typeof Map!="undefined"&&n instanceof Map?g.map:typeof Set!="undefined"&&n instanceof Set?g.set:typeof Date!="undefined"&&n instanceof Date?g.date:g.object;default:return g.unknown}},y=E.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of"]),Or=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class Y extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},r={_errors:[]},i=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,null,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Y.create=n=>new Y(n);const Me=(n,e)=>{let t;switch(n.code){case y.invalid_type:n.received===g.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case y.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected)}`;break;case y.unrecognized_keys:t=`Unrecognized key(s) in object: ${E.joinValues(n.keys,", ")}`;break;case y.invalid_union:t="Invalid input";break;case y.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${E.joinValues(n.options)}`;break;case y.invalid_enum_value:t=`Invalid enum value. Expected ${E.joinValues(n.options)}, received '${n.received}'`;break;case y.invalid_arguments:t="Invalid function arguments";break;case y.invalid_return_type:t="Invalid function return type";break;case y.invalid_date:t="Invalid date";break;case y.invalid_string:n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case y.too_small:n.type==="array"?t=`Array must contain ${n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be greater than ${n.inclusive?"or equal to ":""}${n.minimum}`:t="Invalid input";break;case y.too_big:n.type==="array"?t=`Array must contain ${n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be less than ${n.inclusive?"or equal to ":""}${n.maximum}`:t="Invalid input";break;case y.custom:t="Invalid input";break;case y.invalid_intersection_types:t="Intersection results could not be merged";break;case y.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;default:t=e.defaultError,E.assertNever(n)}return{message:t}};let Te=Me;const Cr=n=>{Te=n},Xe=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,s=[...t,...i.path||[]],a={...i,path:s};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(a,{data:e,defaultError:o}).message;return{...i,path:s,message:i.message||o}},jr=[];function v(n,e){const t=Xe({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Te,Me].filter(r=>!!r)});n.common.issues.push(t)}class k{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return _;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t)r.push({key:await i.key,value:await i.value});return k.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return _;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),(typeof a.value!="undefined"||i.alwaysSet)&&(r[s.value]=a.value)}return{status:e.value,value:r}}}const _=Object.freeze({status:"aborted"}),Dr=n=>({status:"dirty",value:n}),P=n=>({status:"valid",value:n}),lt=n=>n.status==="aborted",dt=n=>n.status==="dirty",Ye=n=>n.status==="valid",ht=n=>typeof Promise!==void 0&&n instanceof Promise;var T;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(T||(T={}));class O{constructor(e,t,r,i){this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._path.concat(this._key)}}const Ut=(n,e)=>{if(Ye(e))return{success:!0,data:e.value};{if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");const t=new Y(n.common.issues);return{success:!1,error:t}}};function w(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid" or "required" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>a.code!=="invalid_type"?{message:o.defaultError}:typeof o.data=="undefined"&&r?{message:r}:n.invalid_type_error?{message:n.invalid_type_error}:{message:o.defaultError},description:i}}class M{constructor(e){this.spa=this.safeParseAsync,this.superRefine=this._refinement,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.default=this.default.bind(this),this.describe=this.describe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return F(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:F(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new k,ctx:{common:e.parent.common,data:e.data,parsedType:F(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ht(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const i={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:F(e)},s=this._parseSync({data:e,path:i.path,parent:i});return Ut(i,s)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:F(e)},i=this._parse({data:e,path:[],parent:r}),s=await(ht(i)?i:Promise.resolve(i));return Ut(r,s)}refine(e,t){const r=i=>typeof t=="string"||typeof t=="undefined"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,s)=>{const a=e(i),o=()=>s.addIssue({code:y.custom,...r(i)});return typeof Promise!="undefined"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new D({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:e}})}optional(){return X.create(this)}nullable(){return J.create(this)}nullish(){return this.optional().nullable()}array(){return C.create(this)}promise(){return de.create(this)}or(e){return Ee.create([this,e])}and(e){return be.create(this,e)}transform(e){return new D({schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new pt({innerType:this,defaultValue:t,typeName:x.ZodDefault})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Xr=/^c[^\s-]{8,}$/i,Yr=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,Gr=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;class U extends M{constructor(){super(...arguments),this._regex=(e,t,r)=>this.refinement(i=>e.test(i),{validation:t,code:y.invalid_string,...T.errToObj(r)}),this.nonempty=e=>this.min(1,T.errToObj(e)),this.trim=()=>new U({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(e){if(this._getType(e)!==g.string){const s=this._getOrReturnCtx(e);return v(s,{code:y.invalid_type,expected:g.string,received:s.parsedType}),_}const r=new k;let i;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),v(i,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,message:s.message}),r.dirty());else if(s.kind==="email")Gr.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"email",code:y.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Yr.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"uuid",code:y.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Xr.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"cuid",code:y.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),v(i,{validation:"url",code:y.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),v(i,{validation:"regex",code:y.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():E.assertNever(s);return{status:r.value,value:e.data}}_addCheck(e){return new U({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...T.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...T.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...T.errToObj(t)})}length(e,t){return this.min(e,t).max(e,t)}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get minLength(){let e=-1/0;return this._def.checks.map(t=>{t.kind==="min"&&(e===null||t.value>e)&&(e=t.value)}),e}get maxLength(){let e=null;return this._def.checks.map(t=>{t.kind==="max"&&(e===null||t.value<e)&&(e=t.value)}),e}}U.create=n=>new U({checks:[],typeName:x.ZodString,...w(n)});function Vr(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,s=parseInt(n.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}class z extends M{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._getType(e)!==g.number){const s=this._getOrReturnCtx(e);return v(s,{code:y.invalid_type,expected:g.number,received:s.parsedType}),_}let r;const i=new k;for(const s of this._def.checks)s.kind==="int"?E.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),v(r,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?Vr(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),v(r,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):E.assertNever(s);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,T.toString(t))}gt(e,t){return this.setLimit("min",e,!1,T.toString(t))}lte(e,t){return this.setLimit("max",e,!0,T.toString(t))}lt(e,t){return this.setLimit("max",e,!1,T.toString(t))}setLimit(e,t,r,i){return new z({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:T.toString(i)}]})}_addCheck(e){return new z({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int")}}z.create=n=>new z({checks:[],typeName:x.ZodNumber,...w(n)});class Ge extends M{_parse(e){if(this._getType(e)!==g.bigint){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.bigint,received:r.parsedType}),_}return P(e.data)}}Ge.create=n=>new Ge({typeName:x.ZodBigInt,...w(n)});class Ve extends M{_parse(e){if(this._getType(e)!==g.boolean){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.boolean,received:r.parsedType}),_}return P(e.data)}}Ve.create=n=>new Ve({typeName:x.ZodBoolean,...w(n)});class Be extends M{_parse(e){if(this._getType(e)!==g.date){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.date,received:r.parsedType}),_}if(isNaN(e.data.getTime())){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_date}),_}return{status:"valid",value:new Date(e.data.getTime())}}}Be.create=n=>new Be({typeName:x.ZodDate,...w(n)});class Fe extends M{_parse(e){if(this._getType(e)!==g.undefined){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.undefined,received:r.parsedType}),_}return P(e.data)}}Fe.create=n=>new Fe({typeName:x.ZodUndefined,...w(n)});class Ue extends M{_parse(e){if(this._getType(e)!==g.null){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.null,received:r.parsedType}),_}return P(e.data)}}Ue.create=n=>new Ue({typeName:x.ZodNull,...w(n)});class ue extends M{constructor(){super(...arguments),this._any=!0}_parse(e){return P(e.data)}}ue.create=n=>new ue({typeName:x.ZodAny,...w(n)});class L extends M{constructor(){super(...arguments),this._unknown=!0}_parse(e){return P(e.data)}}L.create=n=>new L({typeName:x.ZodUnknown,...w(n)});class $ extends M{_parse(e){const t=this._getOrReturnCtx(e);return v(t,{code:y.invalid_type,expected:g.never,received:t.parsedType}),_}}$.create=n=>new $({typeName:x.ZodNever,...w(n)});class Le extends M{_parse(e){if(this._getType(e)!==g.undefined){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.void,received:r.parsedType}),_}return P(e.data)}}Le.create=n=>new Le({typeName:x.ZodVoid,...w(n)});class C extends M{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==g.array)return v(t,{code:y.invalid_type,expected:g.array,received:t.parsedType}),_;if(i.minLength!==null&&t.data.length<i.minLength.value&&(v(t,{code:y.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(v(t,{code:y.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all(t.data.map((a,o)=>i.type._parseAsync(new O(t,a,t.path,o)))).then(a=>k.mergeArray(r,a));const s=t.data.map((a,o)=>i.type._parseSync(new O(t,a,t.path,o)));return k.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new C({...this._def,minLength:{value:e,message:T.toString(t)}})}max(e,t){return new C({...this._def,maxLength:{value:e,message:T.toString(t)}})}length(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}C.create=(n,e)=>new C({type:n,minLength:null,maxLength:null,typeName:x.ZodArray,...w(e)});var $e;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})($e||($e={}));const Lt=n=>e=>new b({...n,shape:()=>({...n.shape(),...e})});function le(n){if(n instanceof b){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=X.create(le(r))}return new b({...n._def,shape:()=>e})}else return n instanceof C?C.create(le(n.element)):n instanceof X?X.create(le(n.unwrap())):n instanceof J?J.create(le(n.unwrap())):n instanceof j?j.create(n.items.map(e=>le(e))):n}class b extends M{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=Lt(this._def),this.extend=Lt(this._def)}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=E.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==g.object){const c=this._getOrReturnCtx(e);return v(c,{code:y.invalid_type,expected:g.object,received:c.parsedType}),_}const{status:r,ctx:i}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];for(const c in i.data)a.includes(c)||o.push(c);const u=[];for(const c of a){const l=s[c],f=i.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new O(i,f,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof $){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:i.data[l]}});else if(c==="strict")o.length>0&&(v(i,{code:y.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const f=i.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new O(i,f,i.path,l)),alwaysSet:l in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const f=await l.key;c.push({key:f,value:await l.value,alwaysSet:l.alwaysSet})}return c}).then(c=>k.mergeObjectSync(r,c)):k.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new b({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,s,a,o;const u=(a=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=T.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new b({...this._def,unknownKeys:"strip"})}passthrough(){return new b({...this._def,unknownKeys:"passthrough"})}setKey(e,t){return this.augment({[e]:t})}merge(e){return new b({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>$e.mergeShapes(this._def.shape(),e._def.shape()),typeName:x.ZodObject})}catchall(e){return new b({...this._def,catchall:e})}pick(e){const t={};return E.objectKeys(e).map(r=>{this.shape[r]&&(t[r]=this.shape[r])}),new b({...this._def,shape:()=>t})}omit(e){const t={};return E.objectKeys(this.shape).map(r=>{E.objectKeys(e).indexOf(r)===-1&&(t[r]=this.shape[r])}),new b({...this._def,shape:()=>t})}deepPartial(){return le(this)}partial(e){const t={};if(e)return E.objectKeys(this.shape).map(r=>{E.objectKeys(e).indexOf(r)===-1?t[r]=this.shape[r]:t[r]=this.shape[r].optional()}),new b({...this._def,shape:()=>t});for(const r in this.shape){const i=this.shape[r];t[r]=i.optional()}return new b({...this._def,shape:()=>t})}required(){const e={};for(const t in this.shape){let i=this.shape[t];for(;i instanceof X;)i=i._def.innerType;e[t]=i}return new b({...this._def,shape:()=>e})}}b.create=(n,e)=>new b({shape:()=>n,unknownKeys:"strip",catchall:$.create(),typeName:x.ZodObject,...w(e)}),b.strictCreate=(n,e)=>new b({shape:()=>n,unknownKeys:"strict",catchall:$.create(),typeName:x.ZodObject,...w(e)}),b.lazycreate=(n,e)=>new b({shape:n,unknownKeys:"strip",catchall:$.create(),typeName:x.ZodObject,...w(e)});class Ee extends M{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=s.map(o=>new Y(o.ctx.common.issues));return v(t,{code:y.invalid_union,unionErrors:a}),_}if(t.common.async)return Promise.all(r.map(async s=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(i);{let s;const a=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!s&&(s={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const o=a.map(u=>new Y(u));return v(t,{code:y.invalid_union,unionErrors:o}),_}}get options(){return this._def.options}}Ee.create=(n,e)=>new Ee({options:n,typeName:x.ZodUnion,...w(e)});class We extends M{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.object)return v(t,{code:y.invalid_type,expected:g.object,received:t.parsedType}),_;const r=this.discriminator,i=t.data[r],s=this.options.get(i);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:y.invalid_union_discriminator,options:this.validDiscriminatorValues,path:[r]}),_)}get discriminator(){return this._def.discriminator}get validDiscriminatorValues(){return Array.from(this.options.keys())}get options(){return this._def.options}static create(e,t,r){const i=new Map;try{t.forEach(s=>{const a=s.shape[e].value;i.set(a,s)})}catch{throw new Error("The discriminator value could not be extracted from all the provided schemas")}if(i.size!==t.length)throw new Error("Some of the discriminator values are not unique");return new We({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:i,...w(r)})}}function ft(n,e){const t=F(n),r=F(e);if(n===e)return{valid:!0,data:n};if(t===g.object&&r===g.object){const i=E.objectKeys(e),s=E.objectKeys(n).filter(o=>i.indexOf(o)!==-1),a={...n,...e};for(const o of s){const u=ft(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===g.array&&r===g.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let s=0;s<n.length;s++){const a=n[s],o=e[s],u=ft(a,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===g.date&&r===g.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class be extends M{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(s,a)=>{if(lt(s)||lt(a))return _;const o=ft(s.value,a.value);return o.valid?((dt(s)||dt(a))&&t.dirty(),{status:t.value,value:o.data}):(v(r,{code:y.invalid_intersection_types}),_)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>i(s,a)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}be.create=(n,e,t)=>new be({left:n,right:e,typeName:x.ZodIntersection,...w(t)});class j extends M{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.array)return v(r,{code:y.invalid_type,expected:g.array,received:r.parsedType}),_;if(r.data.length<this._def.items.length)return v(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,type:"array"}),_;!this._def.rest&&r.data.length>this._def.items.length&&(v(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,type:"array"}),t.dirty());const s=r.data.map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new O(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>k.mergeArray(t,a)):k.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new j({...this._def,rest:e})}}j.create=(n,e)=>new j({items:n,typeName:x.ZodTuple,rest:null,...w(e)});class Se extends M{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.object)return v(r,{code:y.invalid_type,expected:g.object,received:r.parsedType}),_;const i=[],s=this._def.keyType,a=this._def.valueType;for(const o in r.data)i.push({key:s._parse(new O(r,o,r.path,o)),value:a._parse(new O(r,r.data[o],r.path,o))});return r.common.async?k.mergeObjectAsync(t,i):k.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof M?new Se({keyType:e,valueType:t,typeName:x.ZodRecord,...w(r)}):new Se({keyType:U.create(),valueType:e,typeName:x.ZodRecord,...w(t)})}}class ze extends M{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.map)return v(r,{code:y.invalid_type,expected:g.map,received:r.parsedType}),_;const i=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([o,u],c)=>({key:i._parse(new O(r,o,r.path,[c,"key"])),value:s._parse(new O(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return _;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return _;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}}ze.create=(n,e,t)=>new ze({valueType:e,keyType:n,typeName:x.ZodMap,...w(t)});class H extends M{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.set)return v(r,{code:y.invalid_type,expected:g.set,received:r.parsedType}),_;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(v(r,{code:y.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(v(r,{code:y.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,message:i.maxSize.message}),t.dirty());const s=this._def.valueType;function a(u){const c=new Set;for(const l of u){if(l.status==="aborted")return _;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>s._parse(new O(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new H({...this._def,minSize:{value:e,message:T.toString(t)}})}max(e,t){return new H({...this._def,maxSize:{value:e,message:T.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}H.create=(n,e)=>new H({valueType:n,minSize:null,maxSize:null,typeName:x.ZodSet,...w(e)});class q extends M{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.function)return v(t,{code:y.invalid_type,expected:g.function,received:t.parsedType}),_;function r(o,u){return Xe({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Te,Me].filter(c=>!!c),issueData:{code:y.invalid_arguments,argumentsError:u}})}function i(o,u){return Xe({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Te,Me].filter(c=>!!c),issueData:{code:y.invalid_return_type,returnTypeError:u}})}const s={errorMap:t.common.contextualErrorMap},a=t.data;return this._def.returns instanceof de?P(async(...o)=>{const u=new Y([]),c=await this._def.args.parseAsync(o,s).catch(d=>{throw u.addIssue(r(o,d)),u}),l=await a(...c);return await this._def.returns._def.type.parseAsync(l,s).catch(d=>{throw u.addIssue(i(l,d)),u})}):P((...o)=>{const u=this._def.args.safeParse(o,s);if(!u.success)throw new Y([r(o,u.error)]);const c=a(...u.data),l=this._def.returns.safeParse(c,s);if(!l.success)throw new Y([i(c,l.error)]);return l.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new q({...this._def,args:j.create(e).rest(L.create())})}returns(e){return new q({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}}q.create=(n,e,t)=>new q({args:n?n.rest(L.create()):j.create([]).rest(L.create()),returns:e||L.create(),typeName:x.ZodFunction,...w(t)});class He extends M{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}He.create=(n,e)=>new He({getter:n,typeName:x.ZodLazy,...w(e)});class qe extends M{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return v(t,{code:y.invalid_literal,expected:this._def.value}),_}return{status:"valid",value:e.data}}get value(){return this._def.value}}qe.create=(n,e)=>new qe({value:n,typeName:x.ZodLiteral,...w(e)});function Br(n,e){return new Je({values:n,typeName:x.ZodEnum,...w(e)})}class Je extends M{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{expected:E.joinValues(r),received:t.parsedType,code:y.invalid_type}),_}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{received:t.data,code:y.invalid_enum_value,options:r}),_}return P(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}}Je.create=Br;class Ke extends M{_parse(e){const t=E.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==g.string&&r.parsedType!==g.number){const i=E.objectValues(t);return v(r,{expected:E.joinValues(i),received:r.parsedType,code:y.invalid_type}),_}if(t.indexOf(e.data)===-1){const i=E.objectValues(t);return v(r,{received:r.data,code:y.invalid_enum_value,options:i}),_}return P(e.data)}get enum(){return this._def.values}}Ke.create=(n,e)=>new Ke({values:n,typeName:x.ZodNativeEnum,...w(e)});class de extends M{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.promise&&t.common.async===!1)return v(t,{code:y.invalid_type,expected:g.promise,received:t.parsedType}),_;const r=t.parsedType===g.promise?t.data:Promise.resolve(t.data);return P(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}de.create=(n,e)=>new de({type:n,typeName:x.ZodPromise,...w(e)});class D extends M{innerType(){return this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null;if(i.type==="preprocess"){const a=i.transform(r.data);return r.common.async?Promise.resolve(a).then(o=>this._def.schema._parseAsync({data:o,path:r.path,parent:r})):this._def.schema._parseSync({data:a,path:r.path,parent:r})}const s={addIssue:a=>{v(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="refinement"){const a=o=>{const u=i.refinement(o,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?_:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?_:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ye(a))return a;const o=i.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>Ye(a)?Promise.resolve(i.transform(a.value,s)).then(o=>({status:t.value,value:o})):a);E.assertNever(i)}}D.create=(n,e,t)=>new D({schema:n,typeName:x.ZodEffects,effect:e,...w(t)}),D.createWithPreprocess=(n,e,t)=>new D({schema:e,effect:{type:"preprocess",transform:n},typeName:x.ZodEffects,...w(t)});class X extends M{_parse(e){return this._getType(e)===g.undefined?P(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}X.create=(n,e)=>new X({innerType:n,typeName:x.ZodOptional,...w(e)});class J extends M{_parse(e){return this._getType(e)===g.null?P(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}J.create=(n,e)=>new J({innerType:n,typeName:x.ZodNullable,...w(e)});class pt extends M{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===g.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}pt.create=(n,e)=>new X({innerType:n,typeName:x.ZodOptional,...w(e)});class Qe extends M{_parse(e){if(this._getType(e)!==g.nan){const r=this._getOrReturnCtx(e);return v(r,{code:y.invalid_type,expected:g.nan,received:r.parsedType}),_}return{status:"valid",value:e.data}}}Qe.create=n=>new Qe({typeName:x.ZodNaN,...w(n)});const $t=(n,e={},t)=>n?ue.create().superRefine((r,i)=>{if(!n(r)){const s=typeof e=="function"?e(r):e,a=typeof s=="string"?{message:s}:s;i.addIssue({code:"custom",...a,fatal:t})}}):ue.create(),Fr={object:b.lazycreate};var x;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodPromise="ZodPromise"})(x||(x={}));const Ur=(n,e={message:`Input not instance of ${n.name}`})=>$t(t=>t instanceof n,e,!0),Wt=U.create,zt=z.create,Lr=Qe.create,$r=Ge.create,Ht=Ve.create,Wr=Be.create,zr=Fe.create,Hr=Ue.create,qr=ue.create,Jr=L.create,Kr=$.create,Qr=Le.create,ei=C.create,ti=b.create,ni=b.strictCreate,ri=Ee.create,ii=We.create,si=be.create,ai=j.create,oi=Se.create,ci=ze.create,ui=H.create,li=q.create,di=He.create,hi=qe.create,fi=Je.create,pi=Ke.create,mi=de.create,qt=D.create,yi=X.create,gi=J.create,vi=D.createWithPreprocess;var h=Object.freeze({__proto__:null,getParsedType:F,ZodParsedType:g,makeIssue:Xe,EMPTY_PATH:jr,addIssueToContext:v,ParseStatus:k,INVALID:_,DIRTY:Dr,OK:P,isAborted:lt,isDirty:dt,isValid:Ye,isAsync:ht,ZodType:M,ZodString:U,ZodNumber:z,ZodBigInt:Ge,ZodBoolean:Ve,ZodDate:Be,ZodUndefined:Fe,ZodNull:Ue,ZodAny:ue,ZodUnknown:L,ZodNever:$,ZodVoid:Le,ZodArray:C,get objectUtil(){return $e},ZodObject:b,ZodUnion:Ee,ZodDiscriminatedUnion:We,ZodIntersection:be,ZodTuple:j,ZodRecord:Se,ZodMap:ze,ZodSet:H,ZodFunction:q,ZodLazy:He,ZodLiteral:qe,ZodEnum:Je,ZodNativeEnum:Ke,ZodPromise:de,ZodEffects:D,ZodTransformer:D,ZodOptional:X,ZodNullable:J,ZodDefault:pt,ZodNaN:Qe,custom:$t,Schema:M,ZodSchema:M,late:Fr,get ZodFirstPartyTypeKind(){return x},any:qr,array:ei,bigint:$r,boolean:Ht,date:Wr,discriminatedUnion:ii,effect:qt,enum:fi,function:li,instanceof:Ur,intersection:si,lazy:di,literal:hi,map:ci,nan:Lr,nativeEnum:pi,never:Kr,null:Hr,nullable:gi,number:zt,object:ti,oboolean:()=>Ht().optional(),onumber:()=>zt().optional(),optional:yi,ostring:()=>Wt().optional(),preprocess:vi,promise:mi,record:oi,set:ui,strictObject:ni,string:Wt,transformer:qt,tuple:ai,undefined:zr,union:ri,unknown:Jr,void:Qr,ZodIssueCode:y,quotelessJson:Or,ZodError:Y,defaultErrorMap:Me,get overrideErrorMap(){return Te},setErrorMap:Cr});const Jt=h.object({width:h.number().int(),height:h.number().int()}),Kt=h.object({width:h.number().int(),height:h.number().int().optional(),scaleFactors:h.array(h.number().int())}),Qt=["http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/level2.json"],xi=h.object({"@id":h.string().url(),profile:h.enum(Qt)}),_i=h.enum(Qt),wi=h.object({formats:h.string().array().optional(),maxArea:h.number().int().optional(),maxHeight:h.number().int().optional(),maxWidth:h.number().int().optional(),qualities:h.string().array().optional(),supports:h.string().array().optional()}),Mi=h.union([_i,wi]),Ti=h.object({"@context":h.literal("http://iiif.io/api/image/2/context.json"),"@id":h.string().url(),"@type":h.literal("iiif:Image").optional(),protocol:h.literal("http://iiif.io/api/image"),width:h.number().int(),height:h.number().int(),profile:h.array(Mi),sizes:Jt.array().optional(),tiles:Kt.array().optional()}),Ei=["level0","level1","level2"],bi=h.object({id:h.string().url(),type:h.literal("ImageService3"),protocol:h.literal("http://iiif.io/api/image"),profile:h.enum(Ei),width:h.number().int(),height:h.number().int(),maxWidth:h.number().int().optional(),maxHeight:h.number().int().optional(),maxArea:h.number().int().optional(),sizes:Jt.array().optional(),tiles:Kt.array().optional(),extraFeatures:h.string().array().optional()}),Si=["level0","level1","level2"],Ii=h.object({id:h.string().url(),width:h.number().int(),height:h.number().int(),profile:h.enum(Si)}),en=xi.or(Ii),tn=h.string().or(h.string().array()),nn=h.object({"@language":h.string(),"@value":tn}),Ie=tn.or(nn).or(nn.array()),rn=h.object({label:Ie,value:Ie}).array(),Ai=h.object({width:h.number().int(),height:h.number().int(),service:en}),Pi=h.object({resource:Ai}),sn=h.object({"@id":h.string().url(),"@type":h.literal("sc:Canvas"),width:h.number().int(),height:h.number().int(),images:Pi.array().length(1),label:Ie.optional(),metadata:rn.optional()}),Ni=h.object({canvases:sn.array().nonempty()}),ki=h.object({"@id":h.string().url(),"@type":h.literal("sc:Manifest"),sequences:Ni.array().length(1),label:Ie.optional(),description:Ie.optional(),metadata:rn.optional()}),Ae=h.record(h.string(),h.string().array()),an=h.object({label:Ae,value:Ae}).array(),Ri=h.object({type:h.literal("Image"),width:h.number().int(),height:h.number().int(),service:en.array().length(1)}),Zi=h.object({type:h.literal("Annotation"),body:Ri}),Oi=h.object({type:h.literal("AnnotationPage"),items:Zi.array().length(1)}),on=h.object({id:h.string().url(),type:h.literal("Canvas"),width:h.number().int(),height:h.number().int(),items:Oi.array().length(1),label:Ae.optional(),metadata:an.optional()}),Ci=h.object({id:h.string().url(),type:h.literal("Manifest"),items:on.array().nonempty(),label:Ae.optional(),description:Ae.optional(),metadata:an.optional()});sn.or(on);const ji=ki.or(Ci),cn=Ti.or(bi);ji.or(cn);function un({width:n,height:e},t,r,i){const s=r*t.originalWidth,a=i*t.originalHeight,o=r*t.originalWidth+t.width*t.scaleFactor>n?n-r*t.originalWidth:t.width*t.scaleFactor,u=i*t.originalHeight+t.height*t.scaleFactor>e?e-i*t.originalHeight:t.height*t.scaleFactor;let c=t.width,l=t.height;return s+t.width*t.scaleFactor>n&&(c=Math.floor((n-s+t.scaleFactor-1)/t.scaleFactor)),a+t.height*t.scaleFactor>e&&(l=Math.floor((e-a+t.scaleFactor-1)/t.scaleFactor)),{region:{x:s,y:a,width:o,height:u},size:{width:c,height:l}}}function Di({width:n,height:e},t=256){const r=Math.max(n,e)/t,i=Math.ceil(Math.log(r)/Math.log(2));return{scaleFactors:Array.from({length:i},(s,a)=>2**a),width:t}}function Xi({width:n,height:e},t,r){const i=t.height||t.width,s=t.width*r,a=i*r;return{scaleFactor:r,width:t.width,height:i,originalWidth:s,originalHeight:a,columns:Math.ceil(n/s),rows:Math.ceil(e/a)}}function Yi(n,e){return e.map(t=>t.scaleFactors.map(r=>Xi(n,t,r))).flat()}function Gi(n){return!!n.some(e=>e.width&&e.scaleFactors&&e.scaleFactors.length)}function Vi(n,e,t){if(!e||!Gi(e))if(t)e=[Di(n)];else throw new Error("Image does not support tiles or custom regions and sizes.");return Yi(n,e)}function Bi(n,e,t="cover"){if(t==="cover"||t==="contain"){const r=e.width/n.width,i=e.height/n.height,s=t==="cover"?Math.max(r,i):Math.min(r,i),a=n.width*s,o=n.height*s;return{width:a,height:o}}else throw new Error('Size must be either "cover" or "contain"')}const Fi=.8,Ui=1.5;function ln(n,e,t="cover",{sizes:r,tileZoomLevels:i,supportsAnyRegionAndSize:s}){const{width:a,height:o}=Bi(n,e,t);if(r){let u;for(let c of r){const l=c.width/a;if(l>=Fi&&l<=Ui){u=c;break}}if(u)return{size:u}}if(s)return{size:{width:Math.round(a),height:Math.round(o)}};if(i){const u=n.width/a,c=i.map(({scaleFactor:m},A)=>({index:A,scaleFactor:m,diff:Math.abs(m-u)})).sort((m,A)=>m.diff-A.diff),l=i[c[0].index],f=Math.ceil(n.width/(l.scaleFactor*i[0].width)),d=Math.ceil(n.height/(l.scaleFactor*i[0].height));let p=[];for(let m=0;m<d;m++){let A=[];for(let R=0;R<f;R++){const V=un(n,l,R,m);A.push(V)}p.push(A)}return p}throw new Error("Unable to create thumbnail")}const dn=["regionByPx","sizeByWh"];function hn(n){if(n==="http://iiif.io/api/image/2/level0.json")return 0;if(n==="http://iiif.io/api/image/2/level1.json")return 1;if(n==="http://iiif.io/api/image/2/level2.json")return 2;throw new Error("Unsupported IIIF Image Profile")}function Li(n){return{maxWidth:n.maxWidth,maxHeight:n.maxHeight,maxArea:n.maxArea,supportsAnyRegionAndSize:dn.every(e=>n.supports&&n.supports.includes(e))}}function mt(n){if("id"in n){let e=!1;return n.profile==="level0"?"extraFeatures"in n&&(e=dn.every(t=>n.extraFeatures&&n.extraFeatures.includes(t))):e=!0,{maxWidth:"maxWidth"in n?n.maxWidth:void 0,maxHeight:"maxHeight"in n?n.maxHeight:void 0,maxArea:"maxArea"in n?n.maxArea:void 0,supportsAnyRegionAndSize:e}}else if("@id"in n)if(Array.isArray(n.profile)){let e=!1,t=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return n.profile.forEach(s=>{if(typeof s=="string"){const a=hn(s);e=e||a>=1}else{const{maxWidth:a,maxHeight:o,maxArea:u,supportsAnyRegionAndSize:c}=Li(s);a!==void 0&&(r=Math.max(a,r)),o!==void 0&&(t=Math.max(o,t)),u!==void 0&&(i=Math.max(u,i)),e=e||c}}),{maxWidth:r>=0?r:void 0,maxHeight:t>=0?t:void 0,maxArea:i>=0?i:void 0,supportsAnyRegionAndSize:e}}else return{supportsAnyRegionAndSize:hn(n.profile)>=1};else throw new Error("Invalid Image")}class $i{constructor(e,t=!0){if(this.embedded=!0,this.type="image",this.supportsAnyRegionAndSize=null,t){const r=e;let i;if(Array.isArray(r.service)?i=r.service[0]:i=r.service,"@id"in i)this.uri=i["@id"],this.majorVersion=2;else if("id"in i)this.uri=i.id,this.majorVersion=3;else throw new Error("Unsupported IIIF Image Service");const s=mt(i);this.supportsAnyRegionAndSize=s.supportsAnyRegionAndSize}else{if("@id"in e)this.uri=e["@id"],this.majorVersion=2;else if("id"in e)this.uri=e.id,this.majorVersion=3;else throw new Error("Unsupported IIIF Image");if("profile"in e){const r=mt(e);this.supportsAnyRegionAndSize=r.supportsAnyRegionAndSize}}this.width=e.width,this.height=e.height}getImageUrl({region:e,size:t}){let r;e?r=`${e.x},${e.y},${e.width},${e.height}`:r="full";let i;if(t){let s="";t.height&&t.width!==t.height&&(s=String(t.height)),i=`${t.width},${s}`}else i=this.majorVersion===2?"full":"max";return`${this.uri}/${r}/${i}/0/default.jpg`}getThumbnail(e,t="cover"){return ln({width:this.width,height:this.height},e,t,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize})}}class yt extends $i{constructor(e){super(e,!1),this.embedded=!1;const t=mt(e);this.tileZoomLevels=Vi({width:this.width,height:this.height},e.tiles,t.supportsAnyRegionAndSize),this.sizes=e.sizes}static parse(e){const t=cn.parse(e);return new yt(t)}getIiifTile(e,t,r){return un({width:this.width,height:this.height},e,t,r)}getThumbnail(e,t="cover"){return ln({width:this.width,height:this.height},e,t,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels})}}var G={ADDMAP:"addmap",WARPEDMAPADDED:"warpedmapadded",UPDATENEEDEDTILES:"updateneededtiles",WARPEDMAPENTEREXTENT:"warpedmapenterextent",WARPEDMAPLEAVEEXTENT:"warpedmapleaveextent",TILENEEDED:"tileneeded",TILEUNNEEDED:"tileunneeded",TILELOADED:"tileloaded",TILELOADINGERROR:"tileloadingerror",TILESCHANGED:"tileschanged"};class Wi{constructor(e,t,r,i,s,a,o){this.mapId=e,this.map=t,this.transformer=i,this.image=r,this.geoMask=s,this.triangles=o,this.geoExtent=a}}const K=new Map,fn=new Map,pn=new vn;function zi(n){let e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return n.coordinates[0].forEach(s=>{e=Math.min(e,s[0]),t=Math.min(t,s[1]),r=Math.max(r,s[0]),i=Math.max(i,s[1])}),{minX:e,minY:t,maxX:r,maxY:i}}function Q(n,e){postMessage({type:n,data:e})}function Hi(n,e,t){const r=new Map,i=new Set;t.forEach(u=>{const c=e.getIiifTile(u.zoomLevel,u.column,u.row),l=e.getImageUrl(c);r.set(l,{tile:u,imageRequest:c,url:l}),i.add(l)}),K.has(n)||(K.set(n,new Map),Q(G.WARPEDMAPENTEREXTENT,{mapId:n}));const s=K.get(n);let a=[...i].filter(({url:u})=>!s.has(u)),o=[...s.keys()].filter(u=>!i.has(u));a.length&&a.forEach(u=>{const c=r.get(u);Q(G.TILENEEDED,{mapId:n,...c}),s.set(u,c)}),o.length&&o.forEach(u=>{Q(G.TILEUNNEEDED,{mapId:n,url:u}),s.delete(u),s.size===0&&(K.delete(n),Q(G.WARPEDMAPLEAVEEXTENT,{mapId:n}))})}onmessage=async n=>{const{type:e,data:t}=n.data;if(e===G.ADDMAP){const{map:r,mapId:i}=t,s=r.image.uri,a=await fetch(`${s}/info.json`).then(S=>S.json()),o=yt.parse(a),c=r.gcps.map(({world:S,image:gt})=>({world:nr(S),image:gt})),l=gr(c),f=br(l,[...r.pixelMask,r.pixelMask[r.pixelMask.length-1]],.01,0),d=Et.flatten(f.coordinates),m=Et(d.vertices,d.holes,d.dimensions).map(S=>[d.vertices[S*2],d.vertices[S*2+1]]).flat(),A=zi(f),R=new Wi(i,r,o,l,f,A,m);fn.set(i,R);const V={...R.geoExtent,mapId:i};pn.insert(V),Q(G.WARPEDMAPADDED,{mapId:i,image:o,transformer:l,triangles:m})}else if(e===G.UPDATENEEDEDTILES){const{size:r,extent:i,coordinateToPixelTransform:s}=t,[a,o,u,c]=i,l=pn.search({minX:a,minY:o,maxX:u,maxY:c}),f=new Set(K.keys());if(l.length)for(let{mapId:d}of l){const p=fn.get(d);if(!p)continue;const m=[p.geoExtent.minX,p.geoExtent.minY],A=[p.geoExtent.maxX,p.geoExtent.maxY],R=Zt(s,m),V=Zt(s,A),S=Math.abs(V[0]-R[0]),gt=Math.abs(R[1]-V[1]);if(S+gt<1)continue;const qi=p.transformer,mn=p.image,Ji=Zr(qi,mn,r,i);Hi(d,mn,Ji),f.delete(d)}for(let d of f){const p=K.get(d);for(let m of p.keys())Q(G.TILEUNNEEDED,{mapId:d,url:m});K.delete(d),Q(G.WARPEDMAPLEAVEEXTENT,{mapId:d})}}}})();
